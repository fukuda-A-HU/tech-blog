---
title: "Flutterã‚’ç”¨ã„ãŸMapLibreã®åŸºæœ¬çš„ãªæ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•"
emoji: "ğŸ—ºï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter", "MapLibre", "åœ°å›³", "ãƒ¢ãƒã‚¤ãƒ«é–‹ç™º"]
published: false
---

## ã‚´ãƒ¼ãƒ«ï¼ˆã¯ã˜ã‚ã«ï¼‰ï¼šFlutterã‚¢ãƒ—ãƒªã«åœ°å›³æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹

ã“ã®è¨˜äº‹ã§ã¯ã€Flutterã‚¢ãƒ—ãƒªã«MapLibreã‚’çµ„ã¿è¾¼ã‚“ã§ã€åŸºæœ¬çš„ãªåœ°å›³æ©Ÿèƒ½ï¼ˆåœ°å›³è¡¨ç¤ºã€ãƒãƒ¼ã‚«ãƒ¼è¨­ç½®ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½ç½®è¡¨ç¤ºãªã©ï¼‰ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚MapLibreã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®åœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€å•†ç”¨åˆ©ç”¨ã‚‚ç„¡æ–™ã§è¡Œãˆã‚‹ãŸã‚ã€åœ°å›³æ©Ÿèƒ½ã‚’æ‰‹è»½ã«å®Ÿè£…ã—ãŸã„é–‹ç™ºè€…ã«æœ€é©ã§ã™ã€‚

## ã‚„ã£ã¦ã¿ãŸçµæœ

ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã®ã“ã¨ãŒå®Ÿç¾ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š
- Flutterã‚¢ãƒ—ãƒªã«é«˜æ€§èƒ½ãªåœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹
- åœ°å›³ä¸Šã«ãƒãƒ¼ã‚«ãƒ¼ã‚„ãƒãƒªã‚´ãƒ³ãªã©ã‚’é…ç½®ã™ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ä½ç½®ã‚’åœ°å›³ä¸Šã«è¡¨ç¤ºã™ã‚‹
- åœ°å›³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹

## é–‹ç™ºç’°å¢ƒ
- Flutter 3.19.0ä»¥ä¸Š
- Dart 3.3.0ä»¥ä¸Š
- Android Studio / VS Code
- iOS / Androidã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿

## äº‹å‰æº–å‚™

MapLibreã‚’Flutterã§ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…è¦ã§ã™ï¼š
- `maplibre_gl`: MapLibreã®Flutterãƒ—ãƒ©ã‚°ã‚¤ãƒ³

## ã‚„ã£ãŸã“ã¨

ã“ã®è¨˜äº‹ã§ã¯ã€ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã«æ²¿ã£ã¦é€²ã‚ã¦ã„ãã¾ã™ï¼š

1. MapLibre GLãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®š
3. åŸºæœ¬çš„ãªåœ°å›³è¡¨ç¤º
4. åœ°å›³ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ï¼‰
5. ãƒãƒ¼ã‚«ãƒ¼ã®è¿½åŠ 
6. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½ç½®ã®è¡¨ç¤º
7. åœ°å›³ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡

## MapLibre GLã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã¾ãšã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«MapLibre GLãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚`pubspec.yaml`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```yaml
dependencies:
  flutter:
    sdk: flutter
  maplibre_gl: ^0.18.0
  location: ^4.4.0  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½ç½®å–å¾—ç”¨
```

è¿½åŠ ã—ãŸã‚‰ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

```bash
flutter pub get
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®š

### Androidè¨­å®š

Androidç”¨ã®è¨­å®šã‚’è¡Œã†ãŸã‚ã€`android/app/build.gradle`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€ä»¥ä¸‹ã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ï¼š

```gradle
android {
    defaultConfig {
        // ä»–ã®è¨­å®š...
        minSdkVersion 20
    }
}
```

### iOSè¨­å®š

iOSç”¨ã®è¨­å®šã‚’è¡Œã†ãŸã‚ã«ã€`ios/Runner/Info.plist`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä½ç½®æƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®èª¬æ˜ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```xml
<dict>
    <!-- ä»–ã®è¨­å®š... -->
    <key>NSLocationWhenInUseUsageDescription</key>
    <string>ã“ã®ã‚¢ãƒ—ãƒªã¯ãƒãƒƒãƒ—ä¸Šã«ã‚ãªãŸã®ä½ç½®ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ä½ç½®æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™ã€‚</string>
    <key>io.flutter.embedded_views_preview</key>
    <true/>
</dict>
```

## åŸºæœ¬çš„ãªåœ°å›³è¡¨ç¤º

ã¾ãšã€åŸºæœ¬çš„ãªåœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ç°¡å˜ãªã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’`main.dart`ã«è¿½åŠ ã—ã¾ã™ï¼š

```dart
import 'package:flutter/material.dart';
import 'package:maplibre_gl/maplibre_gl.dart';

void main() => runApp(MyApp());

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'MapLibre Demo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: MapScreen(),
    );
  }
}

class MapScreen extends StatefulWidget {
  @override
  _MapScreenState createState() => _MapScreenState();
}

class _MapScreenState extends State<MapScreen> {
  MaplibreMapController? mapController;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('MapLibreå®Ÿè£…ä¾‹'),
      ),
      body: MaplibreMap(
        styleString: 'https://demotiles.maplibre.org/style.json',
        initialCameraPosition: CameraPosition(
          target: LatLng(35.681236, 139.767125), // æ±äº¬é§…
          zoom: 14.0,
        ),
        onMapCreated: (controller) {
          mapController = controller;
        },
      ),
    );
  }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã€æ±äº¬é§…ã‚’ä¸­å¿ƒã«ã—ãŸåŸºæœ¬çš„ãªåœ°å›³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`styleString`ã«ã¯ã€MapLibreã§åˆ©ç”¨å¯èƒ½ãªåœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ã®URLã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

## åœ°å›³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

MapLibreã§ã¯æ§˜ã€…ãªåœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ä»¥ä¸‹ã¯äººæ°—ã®ã‚ã‚‹ã„ãã¤ã‹ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ï¼š

- OpenStreetMapæ¨™æº–: `https://demotiles.maplibre.org/style.json`
- Maptiler Basic: `https://api.maptiler.com/maps/basic/style.json?key=YOUR_MAPTILER_KEY`
- OpenMapTiles: `https://openmaptiles.github.io/osm-bright-gl-style/style-cdn.json`

ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¾ã™ï¼š

```dart
// _MapScreenStateã‚¯ãƒ©ã‚¹å†…ã«è¿½åŠ 
void _changeMapStyle(String styleUrl) {
  mapController?.setStyleString(styleUrl);
}

@override
Widget build(BuildContext context) {
  return Scaffold(
    appBar: AppBar(
      title: Text('MapLibreå®Ÿè£…ä¾‹'),
    ),
    body: Stack(
      children: [
        MaplibreMap(
          styleString: 'https://demotiles.maplibre.org/style.json',
          initialCameraPosition: CameraPosition(
            target: LatLng(35.681236, 139.767125), // æ±äº¬é§…
            zoom: 14.0,
          ),
          onMapCreated: (controller) {
            mapController = controller;
          },
        ),
        Positioned(
          top: 10,
          right: 10,
          child: Column(
            children: [
              ElevatedButton(
                onPressed: () => _changeMapStyle('https://demotiles.maplibre.org/style.json'),
                child: Text('æ¨™æº–ã‚¹ã‚¿ã‚¤ãƒ«'),
              ),
              SizedBox(height: 10),
              ElevatedButton(
                onPressed: () => _changeMapStyle('https://openmaptiles.github.io/osm-bright-gl-style/style-cdn.json'),
                child: Text('æ˜ã‚‹ã„ã‚¹ã‚¿ã‚¤ãƒ«'),
              ),
            ],
          ),
        ),
      ],
    ),
  );
}
```

## ãƒãƒ¼ã‚«ãƒ¼ã®è¿½åŠ 

åœ°å›³ä¸Šã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ï¼š

```dart
// _MapScreenStateã‚¯ãƒ©ã‚¹å†…ã«è¿½åŠ 
final List<Symbol> _symbols = [];

Future<void> _addMarker(LatLng position, String title) async {
  final symbol = await mapController?.addSymbol(
    SymbolOptions(
      geometry: position,
      iconImage: 'marker-15', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒ¼ã‚«ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³
      iconSize: 2.0,
      textField: title,
      textOffset: Offset(0, 1.5),
      textSize: 12.0,
    ),
  );
  
  if (symbol != null) {
    setState(() {
      _symbols.add(symbol);
    });
  }
}
```

ã“ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã€åœ°å›³ä¸Šã‚’ã‚¿ãƒƒãƒ—ã—ãŸã¨ãã«ãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®ã™ã‚‹ã‚ˆã†å®Ÿè£…ã—ã¾ã™ï¼š

```dart
MaplibreMap(
  styleString: 'https://demotiles.maplibre.org/style.json',
  initialCameraPosition: CameraPosition(
    target: LatLng(35.681236, 139.767125), // æ±äº¬é§…
    zoom: 14.0,
  ),
  onMapCreated: (controller) {
    mapController = controller;
  },
  onMapClick: (point, latLng) {
    _addMarker(latLng, 'æ–°ã—ã„ãƒãƒ¼ã‚«ãƒ¼');
  },
),
```

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½ç½®ã®è¡¨ç¤º

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ä½ç½®ã‚’åœ°å›³ä¸Šã«è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ã¾ãš`location`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã€ãã®å¾Œåœ°å›³ã‚’æ›´æ–°ã—ã¾ã™ï¼š

```dart
// importã«è¿½åŠ 
import 'package:location/location.dart';

// _MapScreenStateã‚¯ãƒ©ã‚¹å†…ã«è¿½åŠ 
Location location = Location();
bool _serviceEnabled = false;
PermissionStatus _permissionGranted = PermissionStatus.denied;

Future<void> _initLocationService() async {
  _serviceEnabled = await location.serviceEnabled();
  if (!_serviceEnabled) {
    _serviceEnabled = await location.requestService();
    if (!_serviceEnabled) {
      return;
    }
  }

  _permissionGranted = await location.hasPermission();
  if (_permissionGranted == PermissionStatus.denied) {
    _permissionGranted = await location.requestPermission();
    if (_permissionGranted != PermissionStatus.granted) {
      return;
    }
  }

  // ç¾åœ¨ä½ç½®ã‚’å–å¾—ã—ã¦åœ°å›³ã‚’ç§»å‹•
  final locationData = await location.getLocation();
  final latLng = LatLng(locationData.latitude!, locationData.longitude!);
  
  await mapController?.animateCamera(
    CameraUpdate.newLatLngZoom(latLng, 15.0),
  );
  
  // ç¾åœ¨ä½ç½®ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
  await _addMarker(latLng, 'ç¾åœ¨åœ°');
  
  // ä½ç½®æƒ…å ±ã®æ›´æ–°ã‚’ç›£è¦–
  location.onLocationChanged.listen((LocationData currentLocation) {
    if (mapController != null) {
      mapController!.animateCamera(
        CameraUpdate.newLatLng(
          LatLng(currentLocation.latitude!, currentLocation.longitude!),
        ),
      );
    }
  });
}

@override
void initState() {
  super.initState();
  // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ä½ç½®æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–
  Future.delayed(Duration.zero, () {
    _initLocationService();
  });
}
```

## åœ°å›³ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡

åœ°å›³ã®ã‚ºãƒ¼ãƒ ã€å›è»¢ã€ãƒãƒ«ãƒˆãªã©ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```dart
// Stackã®Childrenã«è¿½åŠ 
Positioned(
  bottom: 20,
  right: 20,
  child: Column(
    children: [
      FloatingActionButton(
        heroTag: "zoom_in",
        child: Icon(Icons.add),
        onPressed: () {
          mapController?.animateCamera(
            CameraUpdate.zoomIn(),
          );
        },
      ),
      SizedBox(height: 10),
      FloatingActionButton(
        heroTag: "zoom_out",
        child: Icon(Icons.remove),
        onPressed: () {
          mapController?.animateCamera(
            CameraUpdate.zoomOut(),
          );
        },
      ),
      SizedBox(height: 10),
      FloatingActionButton(
        heroTag: "current_location",
        child: Icon(Icons.my_location),
        onPressed: _initLocationService,
      ),
    ],
  ),
),
```

## çµè«–ã«å¯¾ã—ã¦ã®è£œè¶³

- **ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ç”»åƒã®ä½¿ç”¨**: ç‹¬è‡ªã®ãƒãƒ¼ã‚«ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ã‚¢ã‚»ãƒƒãƒˆã‚’è¿½åŠ ã—ã€`mapController?.addImage()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ç™»éŒ²ã—ãŸå¾Œã«ä½¿ç”¨ã—ã¾ã™ã€‚

- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åœ°å›³**: MapLibreã¯ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åœ°å›³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚è©³ç´°ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/maplibre/maplibre-gl-native)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: å¤šæ•°ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹å ´åˆã¯ã€é€šå¸¸ã®ãƒãƒ¼ã‚«ãƒ¼ã®ä»£ã‚ã‚Šã«ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

- **ä»£æ›¿ã‚µãƒ¼ãƒ“ã‚¹**: å•†ç”¨ã‚¢ãƒ—ãƒªã§é«˜åº¦ãªæ©Ÿèƒ½ãŒå¿…è¦ãªå ´åˆã¯ã€Google Mapsã‚„Mapboxãªã©ã®æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ã‚‚æ¤œè¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## ãŠã‚ã‚Šã«

ã“ã®è¨˜äº‹ã§ã¯ã€Flutterã‚¢ãƒ—ãƒªã«MapLibreã‚’çµ±åˆã—ã¦åŸºæœ¬çš„ãªåœ°å›³æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã—ãŸã€‚MapLibreã¯ç„¡æ–™ã§ä½¿ãˆã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®åœ°å›³ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€åŸºæœ¬çš„ãªåœ°å›³æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã®ã«ååˆ†ãªæ©Ÿèƒ½ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

ä»Šå›ç´¹ä»‹ã—ãŸåŸºæœ¬æ©Ÿèƒ½ã‚’å¿œç”¨ã™ã‚Œã°ã€ä½ç½®æƒ…å ±ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ—ãƒªãªã©ã€æ§˜ã€…ãªåœ°å›³é–¢é€£ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã§ãã‚‹ã§ã—ã‚‡ã†ã€‚ãœã²å®Ÿéš›ã«è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼

## å‚è€ƒãƒªãƒ³ã‚¯

- [MapLibre GLå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/maplibre/maplibre-gl-native)
- [Flutter MapLibre GL Plugin](https://github.com/maplibre/flutter-maplibre-gl)
- [OpenMapTilesãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ](https://openmaptiles.org/)
