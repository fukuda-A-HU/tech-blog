---
title: "Flutteråˆå¿ƒè€…ã®ãŸã‚ã®Unityé€£æºã‚¬ã‚¤ãƒ‰ - flutter-unity-widgetã®ä½¿ã„æ–¹"
emoji: "ğŸ®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["flutter", "unity", "mobile", "gamedev", "crossplatform"]
published: false
---

# Flutteråˆå¿ƒè€…ã®ãŸã‚ã®Unityé€£æºã‚¬ã‚¤ãƒ‰ - flutter-unity-widgetã®ä½¿ã„æ–¹

ã“ã‚“ã«ã¡ã¯ï¼ã“ã®è¨˜äº‹ã§ã¯ã€Flutteråˆå¿ƒè€…ã®æ–¹å‘ã‘ã«ã€Unityã§ä½œæˆã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’Flutterã‚¢ãƒ—ãƒªã«åŸ‹ã‚è¾¼ã‚€æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚ã€Œflutter-unity-widgetã€ã¨ã„ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã€Unityã®ãƒªãƒƒãƒãªã‚²ãƒ¼ãƒ ã‚„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’Flutterã‚¢ãƒ—ãƒªã«çµ±åˆã™ã‚‹æ‰‹é †ã‚’ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§ç´¹ä»‹ã—ã¾ã™ã€‚

## ã“ã®è¨˜äº‹ã§å­¦ã¹ã‚‹ã“ã¨

- flutter-unity-widgetã®åŸºæœ¬çš„ãªä½¿ã„æ–¹
- Unityå´ã®æº–å‚™ã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ–¹æ³•
- Flutterå´ã§ã®çµ±åˆæ‰‹é †
- å®Ÿéš›ã«å‹•ä½œã™ã‚‹ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

Unityé–‹ç™ºã®çµŒé¨“ãŒãªãã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ï¼ã“ã®è¨˜äº‹ã‚’é€šã˜ã¦ã€Flutterã‚¢ãƒ—ãƒªã®ä¸­ã§Unityã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‹•ã‹ã™åŸºæœ¬çš„ãªæ–¹æ³•ã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## å‰ææ¡ä»¶

ã“ã®è¨˜äº‹ã¯ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚ã¾ã ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã„å ´åˆã¯ã€å„ãƒ„ãƒ¼ãƒ«ã®å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

- Flutter SDKï¼ˆæœ€æ–°ç‰ˆï¼‰
- Android Studio ã¾ãŸã¯ Visual Studio Code
- Unity Hub ã¨ Unity 2020.3 LTS ä»¥é™
- iOSé–‹ç™ºã®å ´åˆã¯ Xcodeï¼ˆmacOSç’°å¢ƒï¼‰

## flutter-unity-widgetã¨ã¯ï¼Ÿ

[flutter-unity-widget](https://github.com/juicycleff/flutter-unity-view-widget)ã¯ã€Flutterã‚¢ãƒ—ãƒªã«Unityã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«çµ±åˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚

ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã†ã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼š

- Unityã§ä½œæˆã—ãŸã‚²ãƒ¼ãƒ ã‚„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’Flutterã‚¢ãƒ—ãƒªã«åŸ‹ã‚è¾¼ã‚€
- Unityã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã®ãƒ‡ãƒ¼ã‚¿ã®ã‚„ã‚Šå–ã‚Šï¼ˆUnityã‹ã‚‰ã®é€šçŸ¥ã‚„Flutterã‹ã‚‰Unityã¸ã®ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ãªã©ï¼‰
- Unityãƒ“ãƒ¥ãƒ¼ã®ã‚µã‚¤ã‚ºèª¿æ•´ã‚„ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º
- AR/VRã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®çµ±åˆ

Unityã¯ãƒªãƒƒãƒãªã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚„ã‚²ãƒ¼ãƒ è¦ç´ ã€ARãªã©ã‚’æ¯”è¼ƒçš„ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’Flutterã‚¢ãƒ—ãƒªã«è¿½åŠ ã—ãŸã„å ´åˆã«å¤§å¤‰ä¾¿åˆ©ã§ã™ã€‚

## å®Ÿè£…æ‰‹é †

Unityã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å«ã‚€Flutterã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹æ‰‹é †ã¯å¤§ããåˆ†ã‘ã¦ä»¥ä¸‹ã®5ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ãªã‚Šã¾ã™ï¼š

1. Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æº–å‚™
2. Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
3. Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
4. Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®çµ±åˆ
5. Flutter-Unityã®é€šä¿¡å‡¦ç†ã®å®Ÿè£…

ãã‚Œã§ã¯é †ç•ªã«è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

## Step 1: Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æº–å‚™

ã¾ãšã€æ–°ã—ã„Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
flutter create flutter_unity_sample
cd flutter_unity_sample
```

æ¬¡ã«ã€pubspec.yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€flutter-unity-widgetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä¾å­˜é–¢ä¿‚ã«è¿½åŠ ã—ã¾ã™ã€‚

```yaml
dependencies:
  flutter:
    sdk: flutter
  cupertino_icons: ^1.0.2
  flutter_unity_widget: ^2022.2.0 # æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„
```

è¿½åŠ ã—ãŸã‚‰ã€ä¾å­˜é–¢ä¿‚ã‚’æ›´æ–°ã—ã¾ã™ã€‚

```bash
flutter pub get
```

## Step 2: Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

æ¬¡ã«ã€çµ±åˆã™ã‚‹Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ä»Šå›ã¯ç°¡å˜ãªå›è»¢ã™ã‚‹ç«‹æ–¹ä½“ã‚’è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

### Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ–°è¦ä½œæˆ

1. Unity Hubã‚’é–‹ãã¾ã™
2. ã€Œæ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™
3. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ã€Œ3Dã€ã‚’é¸æŠã—ã¾ã™
4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ã€ŒUnityProjectã€ã«ã—ã¦ã€å ´æ‰€ã¯Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜éšå±¤ã‹è¦šãˆã‚„ã™ã„å ´æ‰€ã‚’æŒ‡å®šã—ã¾ã™
5. ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™

### ã‚·ãƒ¼ãƒ³ã®ä½œæˆ

UnityãŒèµ·å‹•ã—ãŸã‚‰ã€ä»¥ä¸‹ã®æ‰‹é †ã§ç°¡å˜ãªã‚·ãƒ¼ãƒ³ã‚’ä½œæˆã—ã¾ã™ï¼š

1. æ–°ã—ã„ã‚·ãƒ¼ãƒ³ã‚’ä½œæˆã—ã€ã€ŒMainSceneã€ã¨ã„ã†åå‰ã§ä¿å­˜ã—ã¾ã™
2. ã‚·ãƒ¼ãƒ³ã«ç«‹æ–¹ä½“ã‚’è¿½åŠ ã—ã¾ã™ï¼šã€ŒGameObjectã€>ã€Œ3D Objectã€>ã€ŒCubeã€
3. ç«‹æ–¹ä½“ã‚’å›è»¢ã•ã›ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š
   - ã€ŒProjectã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§å³ã‚¯ãƒªãƒƒã‚¯ã—ã€ã€ŒCreateã€>ã€ŒC# Scriptã€ã‚’é¸æŠ
   - ã€ŒRotateCubeã€ã¨ã„ã†åå‰ã‚’ä»˜ã‘ã¾ã™
   - ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç·¨é›†ã—ã¾ã™

RotateCube.csã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å†…å®¹ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ï¼š

```csharp
using UnityEngine;

public class RotateCube : MonoBehaviour
{
    public float rotationSpeed = 30.0f;
    
    void Update()
    {
        // æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ã€Yè»¸ã‚’ä¸­å¿ƒã«å›è»¢
        transform.Rotate(0, rotationSpeed * Time.deltaTime, 0);
    }
    
    // Flutterã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
    public void ChangeColor(string colorHex)
    {
        Color newColor;
        if (ColorUtility.TryParseHtmlString("#" + colorHex, out newColor))
        {
            GetComponent<Renderer>().material.color = newColor;
        }
    }
}
```

4. ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç«‹æ–¹ä½“ã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ï¼š
   - Hierarchyã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ç«‹æ–¹ä½“ã‚’é¸æŠ
   - Inspectorä¸Šéƒ¨ã®AddComponentãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã€ŒScriptsã€>ã€ŒRotateCubeã€ã‚’é¸æŠ

5. Flutter-Unityé–“ã®é€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š
   - ã€ŒFlutterUnityInterfaceã€ã¨ã„ã†åå‰ã®C#ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ
   - ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™

```csharp
using UnityEngine;
using UnityEngine.UI;
using System.Runtime.InteropServices;

public class FlutterUnityInterface : MonoBehaviour
{
    // Unityã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰
    public void SendMessageToFlutter(string message)
    {
        #if UNITY_ANDROID && !UNITY_EDITOR
            using (AndroidJavaClass unityPlayer = new AndroidJavaClass("com.unity3d.player.UnityPlayer"))
            {
                AndroidJavaObject activity = unityPlayer.GetStatic<AndroidJavaObject>("currentActivity");
                activity.Call("SendMessageToFlutter", message);
            }
        #elif UNITY_IOS && !UNITY_EDITOR
            // iOSã®å ´åˆã¯Objective-Cãƒ–ãƒªãƒƒã‚¸ã‚’é€šã˜ã¦å‘¼ã³å‡ºã™
            // å®Ÿéš›ã«å®Ÿè£…ã™ã‚‹å ´åˆã¯è¿½åŠ ã®å¯¾å¿œãŒå¿…è¦
            NativeAPI.SendMessageToFlutter(message);
        #endif
        
        // ã‚¨ãƒ‡ã‚£ã‚¿ã§ã®ãƒ‡ãƒãƒƒã‚°ç”¨
        Debug.Log($"SendMessageToFlutter: {message}");
    }
    
    // Flutterã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
    public void HandleMessage(string message)
    {
        Debug.Log($"Received message from Flutter: {message}");
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¿œã˜ã¦å‡¦ç†ã‚’åˆ†ã‘ã‚‹
        if (message.StartsWith("COLOR:"))
        {
            string colorCode = message.Replace("COLOR:", "");
            GameObject cube = GameObject.Find("Cube");
            if (cube != null)
            {
                cube.GetComponent<RotateCube>().ChangeColor(colorCode);
            }
        }
        else if (message == "PING")
        {
            // Flutterã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
            SendMessageToFlutter("PONG");
        }
    }
}
```

6. ç©ºã®ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ï¼š
   - Hierarchyã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§å³ã‚¯ãƒªãƒƒã‚¯ã—ã€ã€ŒCreate Emptyã€ã‚’é¸æŠ
   - åå‰ã‚’ã€ŒFlutterUnityInterfaceã€ã«å¤‰æ›´
   - FlutterUnityInterfaceã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™

## Step 3: Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã®è¨­å®šã‚’è¡Œã„ã¾ã™ï¼š

### ãƒ“ãƒ«ãƒ‰è¨­å®šã®æ§‹æˆï¼ˆAndroidå‘ã‘ï¼‰

1. ã€ŒFileã€>ã€ŒBuild Settingsã€ã‚’é–‹ãã¾ã™
2. ã€ŒAndroidã€ã‚’é¸æŠã—ã€ã€ŒSwitch Platformã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼ˆå¿…è¦ãªå ´åˆï¼‰
3. ã€ŒPlayer Settingsã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä»¥ä¸‹ã®è¨­å®šã‚’è¡Œã„ã¾ã™ï¼š
   - ã€ŒOther Settingsã€>ã€ŒRenderingã€>ã€ŒAuto Graphics APIã€ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã€OpenGLESã‚’ä¸Šä½ã«è¨­å®š
   - ã€ŒOther Settingsã€>ã€ŒIdentificationã€>ã€ŒMinimum API Levelã€ã‚’24ä»¥ä¸Šã«è¨­å®š
   - ã€ŒOther Settingsã€>ã€ŒConfigurationã€>ã€ŒScripting Backendã€ã‚’IL2CPPã«è¨­å®š
   - ã€ŒPublishing Settingsã€>ã€ŒBuildã€ã§ã€ŒCustom Base Gradle Templateã€ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹

### Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

1. ã€ŒFileã€>ã€ŒBuild Settingsã€ã‚’é–‹ã
2. ã€ŒExport Projectã€ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
3. ã€ŒExportã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå…ˆã¨ã—ã¦ã€Œunity_exportã€ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã™ã‚‹ï¼ˆFlutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®éš£ã«ä½œæˆã™ã‚‹ã¨ã‚ˆã„ï¼‰

ã“ã‚Œã§ã€Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚

## Step 4: Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®çµ±åˆ

### Androidã®è¨­å®šï¼ˆAndroidå‘ã‘ï¼‰

Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€Œandroidã€ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ï¼š

1. `android/settings.gradle`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```gradle
include ':unityExport'
project(':unityExport').projectDir = file('../../unity_export/unityExport')
```

2. `android/app/build.gradle`ã‚’é–‹ãã€dependenciesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```gradle
dependencies {
    implementation project(':unityExport')
    // ä»–ã®ä¾å­˜é–¢ä¿‚...
}
```

3. `android/app/src/main/AndroidManifest.xml`ã«ã‚«ãƒ¡ãƒ©æ¨©é™ï¼ˆARã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    package="com.example.flutter_unity_sample">
    
    <uses-permission android:name="android.permission.CAMERA" />
    
    <application
       ...
    </application>
</manifest>
```

### iOSã®è¨­å®šï¼ˆiOSå‘ã‘ï¼šmacOSã®ã¿ï¼‰

iOSã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹å ´åˆã¯ã€Xcodeã§Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’çµ±åˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ãªiOSç”¨ã®è¨­å®šã¯ã‚„ã‚„è¤‡é›‘ãªãŸã‚ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## Step 5: Flutterã‚¢ãƒ—ãƒªã®å®Ÿè£…

æœ€å¾Œã«ã€Flutterã‚¢ãƒ—ãƒªã‹ã‚‰Unityã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã—ã€é€šä¿¡ã™ã‚‹éƒ¨åˆ†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

`lib/main.dart`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ï¼š

```dart
import 'package:flutter/material.dart';
import 'package:flutter_unity_widget/flutter_unity_widget.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Unity Sample',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: const UnityViewExample(),
    );
  }
}

class UnityViewExample extends StatefulWidget {
  const UnityViewExample({Key? key}) : super(key: key);

  @override
  _UnityViewExampleState createState() => _UnityViewExampleState();
}

class _UnityViewExampleState extends State<UnityViewExample> {
  // UnityWidgetã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
  UnityWidgetController? _unityWidgetController;
  
  // Unityã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã™ã‚‹å¤‰æ•°
  String _messageFromUnity = 'Unityã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™';
  
  // è‰²ã®é¸æŠè‚¢
  final List<Color> _colors = [
    Colors.red,
    Colors.green,
    Colors.blue,
    Colors.yellow,
    Colors.purple,
  ];

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Flutter Unity é€£æºã‚µãƒ³ãƒ—ãƒ«'),
      ),
      body: Column(
        children: [
          // Unityãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºï¼ˆç”»é¢ã®ä¸Šéƒ¨2/3ç¨‹åº¦ï¼‰
          Expanded(
            flex: 3,
            child: UnityWidget(
              onUnityCreated: _onUnityCreated,
              onUnityMessage: _onUnityMessage,
              onUnitySceneLoaded: _onUnitySceneLoaded,
              fullscreen: false,
            ),
          ),
          
          // Flutterã§å®Ÿè£…ã—ãŸUIï¼ˆç”»é¢ã®ä¸‹éƒ¨1/3ç¨‹åº¦ï¼‰
          Expanded(
            flex: 2,
            child: Container(
              padding: const EdgeInsets.all(16.0),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.stretch,
                children: [
                  // Unityã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                  Text(
                    _messageFromUnity,
                    style: const TextStyle(fontSize: 16),
                  ),
                  const SizedBox(height: 16),
                  
                  // é€šä¿¡ãƒ†ã‚¹ãƒˆç”¨ãƒœã‚¿ãƒ³
                  ElevatedButton(
                    onPressed: _sendPingToUnity,
                    child: const Text('Unityé€šä¿¡ãƒ†ã‚¹ãƒˆ (PINGé€ä¿¡)'),
                  ),
                  const SizedBox(height: 16),
                  
                  // è‰²å¤‰æ›´ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                  const Text('ç«‹æ–¹ä½“ã®è‰²ã‚’å¤‰æ›´:'),
                  const SizedBox(height: 8),
                  
                  // è‰²ãƒœã‚¿ãƒ³ã®è¡Œ
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                    children: _colors.map((color) {
                      return GestureDetector(
                        onTap: () => _changeUnityColor(color),
                        child: Container(
                          width: 40,
                          height: 40,
                          decoration: BoxDecoration(
                            color: color,
                            shape: BoxShape.circle,
                            border: Border.all(color: Colors.black, width: 2),
                          ),
                        ),
                      );
                    }).toList(),
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }

  // Unityãƒ“ãƒ¥ãƒ¼ãŒä½œæˆã•ã‚ŒãŸã¨ãã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  void _onUnityCreated(UnityWidgetController controller) {
    _unityWidgetController = controller;
    setState(() {
      _messageFromUnity = 'UnityåˆæœŸåŒ–å®Œäº†ï¼';
    });
  }

  // Unityã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  void _onUnityMessage(dynamic message) {
    print('Unityã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: $message');
    setState(() {
      _messageFromUnity = 'Unityã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: $message';
    });
  }

  // Unityã®ã‚·ãƒ¼ãƒ³ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã¨ãã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  void _onUnitySceneLoaded(SceneLoaded sceneInfo) {
    print('Unityã‚·ãƒ¼ãƒ³ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸ: ${sceneInfo.name}');
    setState(() {
      _messageFromUnity = 'ã‚·ãƒ¼ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†: ${sceneInfo.name}';
    });
  }

  // Unityã«PINGãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
  void _sendPingToUnity() {
    _unityWidgetController?.postMessage(
      'FlutterUnityInterface',
      'HandleMessage',
      'PING',
    );
    setState(() {
      _messageFromUnity = 'PINGã‚’Unityã«é€ä¿¡ã—ã¾ã—ãŸ...';
    });
  }

  // ç«‹æ–¹ä½“ã®è‰²ã‚’å¤‰æ›´ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
  void _changeUnityColor(Color color) {
    // Colorã‚’#RRGGBBå½¢å¼ã®æ–‡å­—åˆ—ã«å¤‰æ›ï¼ˆ#ã‚’é™¤ãï¼‰
    String colorHex = color.value.toRadixString(16).substring(2, 8);
    
    _unityWidgetController?.postMessage(
      'FlutterUnityInterface',
      'HandleMessage',
      'COLOR:$colorHex',
    );
    
    setState(() {
      _messageFromUnity = 'è‰²ã‚’å¤‰æ›´: #$colorHex';
    });
  }
}
```

## ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ

ã“ã‚Œã§ã€Unityã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’Flutterã‚¢ãƒ—ãƒªã«çµ±åˆã—ãŸæº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚ã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚

```bash
flutter run
```

Androidãƒ‡ãƒã‚¤ã‚¹ã¾ãŸã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ï¼š

- ç”»é¢ä¸Šéƒ¨ï¼šUnityã§å®Ÿè£…ã—ãŸå›è»¢ã™ã‚‹ç«‹æ–¹ä½“
- ç”»é¢ä¸‹éƒ¨ï¼šFlutterã§å®Ÿè£…ã—ãŸUIï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ã¨ãƒœã‚¿ãƒ³ï¼‰

UIã®è‰²ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€Unityã®ç«‹æ–¹ä½“ã®è‰²ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ã€ŒUnityé€šä¿¡ãƒ†ã‚¹ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€Unityã«ã€ŒPINGã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã€Unityã‹ã‚‰ã€ŒPONGã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚

## ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

**å•é¡Œ**: Androidãƒ“ãƒ«ãƒ‰æ™‚ã«ã€ŒManifest merger failedã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹

**è§£æ±ºç­–**: AndroidManifest.xmlã§ç«¶åˆã—ã¦ã„ã‚‹è¨­å®šãŒã‚ã‚‹å ´åˆã€tools:replaceã‚’ä½¿ã£ã¦è§£æ±ºã—ã¾ã™ï¼š

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    package="com.example.flutter_unity_sample">
    
    <application
        android:label="flutter_unity_sample"
        android:icon="@mipmap/ic_launcher"
        tools:replace="android:label">
        <!-- ä»–ã®è¨­å®š -->
    </application>
</manifest>
```

**å•é¡Œ**: ã€ŒNative librariesã€é–¢é€£ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹

**è§£æ±ºç­–**: flutter-unity-widgetã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨Unityã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®äº’æ›æ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€Unityã®è¨­å®šã§IL2CPPãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

### å®Ÿè¡Œæ™‚ã®å•é¡Œ

**å•é¡Œ**: Unityã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼ˆé»’ã„ç”»é¢ã«ãªã‚‹ï¼‰

**è§£æ±ºç­–**:
1. Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæ­£ã—ãã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. ãƒ“ãƒ«ãƒ‰è¨­å®šãŒæ­£ã—ã„ã‹ç¢ºèªï¼ˆç‰¹ã«Graphics APIã®è¨­å®šï¼‰
3. UnityWidgetãŒæ­£ã—ãåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**å•é¡Œ**: Flutterã¨Unityé–“ã®é€šä¿¡ãŒæ©Ÿèƒ½ã—ãªã„

**è§£æ±ºç­–**:
1. GameObjectåã¨ãƒ¡ã‚½ãƒƒãƒ‰åãŒå®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª
2. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ãé€å—ä¿¡ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

## ã¾ã¨ã‚

ã“ã®è¨˜äº‹ã§ã¯ã€Flutteråˆå¿ƒè€…å‘ã‘ã«ã€flutter-unity-widgetã‚’ä½¿ã£ã¦Unityã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’Flutterã‚¢ãƒ—ãƒªã«çµ±åˆã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®å†…å®¹ã‚’å­¦ã³ã¾ã—ãŸï¼š

- Unityå´ã§ã®æº–å‚™ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
- Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã®çµ±åˆ
- Flutter-Unityé–“ã®é€šä¿¡æ–¹æ³•

flutter-unity-widgetã‚’ä½¿ã†ã“ã¨ã§ã€Flutterã‚¢ãƒ—ãƒªã«Unityè£½ã®3Dã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€ã‚²ãƒ¼ãƒ ã€ARãªã©ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Flutterå˜ä½“ã§ã¯å®Ÿç¾ãŒé›£ã—ã„æ©Ÿèƒ½ã‚‚ã€æ¯”è¼ƒçš„ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ãŸã ã—æ³¨æ„ç‚¹ã¨ã—ã¦ã€Unityã‚’çµ±åˆã™ã‚‹ã¨ã‚¢ãƒ—ãƒªã®ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹ã“ã¨ã¨ã€ãƒ“ãƒ«ãƒ‰è¨­å®šãŒã‚„ã‚„è¤‡é›‘ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ç›®çš„ã«å¿œã˜ã¦æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- [flutter-unity-widget GitHub](https://github.com/juicycleff/flutter-unity-view-widget)
- [Flutterå…¬å¼ã‚µã‚¤ãƒˆ](https://flutter.dev/)
- [Unityå…¬å¼ã‚µã‚¤ãƒˆ](https://unity.com/ja)
